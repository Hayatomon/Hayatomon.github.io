!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self)["quantized-mesh-decoder"]={})}(this,(function(e){"use strict";const t=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function n(e){return e>>1^-(1&e)}function r(e,t,n,r,i=!0){let E;if(E=2===r?new Uint16Array(e,t,n):new Uint32Array(e,t,n),!i)return E;let o=0;for(let e=0;e<E.length;++e){let t=E[e];E[e]=o-t,0===t&&++o}return E}function i(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function E(e){const t=e.getUint32(0,!0);let n="";for(let r=0;r<t;++r)n+=String.fromCharCode(e.getUint8(Uint32Array.BYTES_PER_ELEMENT+r));return JSON.parse(n)}const o={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},s={maxDecodingStep:o.extensions};e.DECODING_STEPS=o,e.default=function(e,a){const c=Object.assign({},s,a),d=new DataView(e),{header:f,headerEndPosition:u}=function(e){let n=0;const r={};for(let[i,E]of t){const t=8===E?e.getFloat64:e.getFloat32;r[i]=t.call(e,n,!0),n+=E}return{header:r,headerEndPosition:n}}(d);if(c.maxDecodingStep<o.vertices)return{header:f};const{vertexData:_,vertexDataEndPosition:l}=function(e,t){let r=t;const i=e.getUint32(r,!0),E=new Uint16Array(3*i);r+=Uint32Array.BYTES_PER_ELEMENT;const o=Uint16Array.BYTES_PER_ELEMENT,s=i*o,a=r,c=a+s,d=c+s;let f=0,u=0,_=0;for(let t=0;t<i;t++)f+=n(e.getUint16(a+o*t,!0)),u+=n(e.getUint16(c+o*t,!0)),_+=n(e.getUint16(d+o*t,!0)),E[t]=f,E[t+i]=u,E[t+2*i]=_;return r+=3*s,{vertexData:E,vertexDataEndPosition:r}}(d,u);if(c.maxDecodingStep<o.triangleIndices)return{header:f,vertexData:_};const{triangleIndices:T,triangleIndicesEndPosition:g}=function(e,t,n){let i=n;const E=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%E!=0&&(i+=E-i%E);const o=e.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const s=3*o,a=r(e.buffer,i,s,E);return i+=s*E,{triangleIndicesEndPosition:i,triangleIndices:a}}(d,_,l);if(c.maxDecodingStep<o.edgeIndices)return{header:f,vertexData:_,triangleIndices:T};const{westIndices:y,southIndices:P,eastIndices:h,northIndices:S,edgeIndicesEndPosition:U}=function(e,t,n){let i=n;const E=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,o=e.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const s=r(e.buffer,i,o,E,!1);i+=o*E;const a=e.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const c=r(e.buffer,i,a,E,!1);i+=a*E;const d=e.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const f=r(e.buffer,i,d,E,!1);i+=d*E;const u=e.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;const _=r(e.buffer,i,u,E,!1);return i+=u*E,{edgeIndicesEndPosition:i,westIndices:s,southIndices:c,eastIndices:f,northIndices:_}}(d,_,g);if(c.maxDecodingStep<o.extensions)return{header:f,vertexData:_,triangleIndices:T,westIndices:y,northIndices:S,eastIndices:h,southIndices:P};const{extensions:A}=function(e,t){const n={};if(e.byteLength<=t)return{extensions:n,extensionsEndPosition:t};let r=t;for(;r<e.byteLength;){const t=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT;const s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=new DataView(e.buffer,r,s);switch(t){case 1:n.vertexNormals=(o=a,new Uint8Array(o.buffer,o.byteOffset,o.byteLength));break;case 2:n.waterMask=i(a);break;case 4:n.metadata=E(a);break;default:console.warn("Unknown extension with id "+t)}r+=s}var o;return{extensions:n,extensionsEndPosition:r}}(d,U);return{header:f,vertexData:_,triangleIndices:T,westIndices:y,northIndices:S,eastIndices:h,southIndices:P,extensions:A}},Object.defineProperty(e,"__esModule",{value:!0})}));
